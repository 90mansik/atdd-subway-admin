## 구현 기능 목록 명세

__1단계 - 지하철역 인수 테스트 작성__

- 지하철역 목록 조회 인수 테스트 작성하기
  * Given 2개의 지하철역을 생성하고
  * When 지하철역 목록을 조회하면
  * Then 2개의 지하철역을 응답 받는다
- 지하철역 삭제 인수 테스트 작성하기
  * Given 지하철역을 생성하고
  * When 그 지하철역을 삭제하면
  * Then 그 지하철역 목록 조회 시 생성한 역을 찾을 수 없다


__2단계 - 지하철 노선 기능__

### 프로그래밍 요구사항

> 아래의 순서로 기능을 구현하세요.
인수 조건을 검증하는 인수 테스트 작성
인수 테스트를 충족하는 기능 구현
인수 테스트의 결과가 다른 인수 테스트에 영향을 끼치지 않도록 인수 테스트를 서로 격리 시키세요.
인수 테스트의 재사용성과 가독성, 그리고 빠른 테스트 의도 파악을 위해 인수 테스트를 리팩터링 하세요.

### 인수 조건

### 기능 요구사항

> #### 지하철노선 생성  
> When 지하철 노선을 생성하면
Then 지하철 노선 목록 조회 시 생성한 노선을 찾을 수 있다

> #### 지하철노선 목록 조회  
> Given 2개의 지하철 노선을 생성하고  
> When 지하철 노선 목록을 조회하면  
> Then 지하철 노선 목록 조회 시 2개의 노선을 조회할 수 있다.


> #### 지하철노선 조회  
> Given 지하철 노선을 생성하고  
When 생성한 지하철 노선을 조회하면  
Then 생성한 지하철 노선의 정보를 응답받을 수 있다.


> #### 지하철노선 수정  
> Given 지하철 노선을 생성하고  
When 생성한 지하철 노선을 수정하면  
Then 해당 지하철 노선 정보는 수정된다


> #### 지하철노선 삭제
> Given 지하철 노선을 생성하고
When 생성한 지하철 노선을 삭제하면
Then 해당 지하철 노선 정보는 삭제된다

### 기능 구현 목록

- 노선 생성 api 를 작성한다
   - 지하철 노선은 여러개의 지하철역을 가질 수 있다
   - 지하철역은 section 이라는 객체를 통해 소유한다
- 노선 목록 조회 api 를 작성한다
  - api 작성 시 n + 1 을 주의한다
- 노선 조회 api 를 작성한다
- 노선 수정 api 를 작성한다
- 노선 삭제 api 를 작성한다
- 인수 테스트시 dynamic Test 이용해 가독성을 고려해본다
- 테스트 컨텍스트의 격리에 대해 고민한다
  - 테스트 크기가 커 매번 컨텍스트를 올리기 부담된다면 test db truncate 를 고려한다



<hr>

__3단계 - 구간 추가 기능__

### 프로그래밍 요구사항

> 인수 테스트 주도 개발 프로세스에 맞춰서 기능을 구현하세요.  
> - 요구사항 설명을 참고하여 인수 조건을 정의
> 
> - 인수 조건을 검증하는 인수 테스트 작성
> 
> - 인수 테스트를 충족하는 기능 구현
> 
> 인수 조건은 인수 테스트 메서드 상단에 주석으로 작성하세요.
> - 뼈대 코드의 인수 테스트를 참고
> 
> 인수 테스트의 결과가 다른 인수 테스트에 영향을 끼치지 않도록 인수 테스트를 서로 격리 시키세요.  
> 인수 테스트의 재사용성과 가독성, 그리고 빠른 테스트 의도 파악을 위해 인수 테스트를 리팩터링 하세요.



### 지하철 구간 등록 인수 테스트 작성과 기능 구현

```
역 사이에 새로운 역을 등록할 경우
- 새로운 길이를 뺀 나머지를 새롭게 추가된 역과의 길이로 설정
```

```
새로운 역을 상행 종점으로 등록할 경우
- 기존 upstation 을 downStation 으로 갖는 새로운 노선이 추가되어야 함
```

```
새로운 역을 하행 종점으로 등록할 경우
- 기존 downstation 을 upStation 으로 갖는 새로운 노선이 추가되어야 함
```

```
예외 케이스
- 역 사이에 새로운 역 등록시 기존 역 사이보다 길이가 크거나 같으면 등록 안됨
```

```
상행역과 하행역이 이미 노선에 모두 등록되어 있으면 등록할 수 없음
```

```
상행역과 하행역 모두 노선에 포함되어 있지 않으면 등록할 수 없음
```

### 기능 구현 목록

- 하나의 Line 에 여러개의 노선이 들어갈 수 있게 엔티티 구조 변경
- 노선 등록 기능 구현
  - 등록 시  역 사이, 상행 종점, 하행 종점 어떤 case 인지 판단하는 로직 작성


- 역 사이에 등록하는 경우
  - 기존 노선의 거리가 추가되는 노선의 거리만큼 차감되어 계산되어야 한다
  - 기존 노선의 upStation or downStation 이 연결되는 노선과 맺어져 변경된다  
ex) 기존 노선 10, 추가되는 노선 5 -> 기존 노선의 길이는 5로 변하고 연결되는 station 도 변경된다
  - 추가되는 노선의 길이가 기존 노선보다 길거나 같으면 등록못하는 로직 작성

- 상행역에 등록하는 경우
  - 기존 상행 종점(upStation) 을 downStation 으로 갖는 신규 노선 생성

- 하행역에 등록하는 경우
  - 기존 하행 종점(downStation) 을 upStation 으로 갖는 신규 노선 생성


<hr>

__4단계 - 구간 제거 기능__

지하철 구간 삭제 request

```
DELETE /lines/1/sections?stationId=2 HTTP/1.1
accept: */*
host: localhost:52165
```


### 노선의 구간을 제거하는 기능을 구현하기
- 종점이 제거될 경우 다음으로 오던 역이 종점이 됨
- 중간역이 제거될 경우 재배치를 함
  - 노선에 A - B - C 역이 연결되어 있을 때 B역을 제거할 경우 A - C로 재배치 됨
  - 거리는 두 구간의 거리의 합으로 정함

### 구간 삭제 시 예외 케이스를 고려하기

구간이 하나인 노선에서 마지막 구간을 제거할 때는 제거할 수 없음


### 기능 구현 목록

- 구간 삭제시 종점인지, 중간인지 판단하는 기능을 작성
  - 종점이면 다음에 오던역을 종점으로 처리하는 기능 작성
  - 중간역이면 노선을 재배치하는 기능 작성
- 구간이 하나인 노선 제거시 예외처리 기능 작성
