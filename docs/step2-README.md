2단계-지하철 노선 기능
===
# 미션 설명
### 기능 요구사항
- `요구사항 설명`에서 제공되는 인수 조건을 기반으로 지하철 노선 관리 기능을 구현하세요.
- 인수 조건을 검증하는 인수테스트를 작성하세요.

### 프로그래밍 요구사항
- 아래의 순서로 기능을 구현하세요.
  - 인수 조건을 검증하는 인수 테스트 작성
  - 인수 테스트를 충족하는 기능 구현
- 인수 테스트의 결과가 다른 인수 테스트에 영향을 끼치지 않도록 인수테스트를 서로 격리 시키세요.
- 인수 테스트의 재사용성과 가독성, 그리고 빠른 테스트의도 파악을 위해 인수 테스트를 리팩터링 하세요.

### 요구사항 설명 : 인수 조건
[ ] 지하철 노선 생성
```
When 지하철 노선을 생성하면
Then 지하철 노선 목록 조회 시 생성한 노선을 찾을 수 있다.
```

[ ] 지하철 노선 목록 조회
```
Given 2개의 지하철 노선을 생성하고
When 지하철 노선 목록을 조회하면
Then 지하철 노선 목록 조회 시 2개의 노선을 조회할 수 있다.
```

[ ] 지하철 노선 조회
```
Given 1개의 지하철 노선을 생성하고
When 특정 지하철 노선을 조회하면
Then 생성된 지하철 노선 정보를 조회할 수 있다.
```

[ ] 지하철 노선 수정
```
Gvien 1개의 지하철 노선을 생성하고
When 해당 지하철 노선을 수정하면
Then 지하철 노선이 정보가 수정 된다.
```

[ ] 지하철 노선 삭제
```
Gvien 1개의 지하철 노선을 생성하고
When 해당 지하철 노선을 삭제하면
Then 지하철 노선 정보가 삭제 된다.
```

API 명세
```
노선 생성 시 상행종점역과 하행종점역을 등록합니다. 
따라서 이번 단계에서는 지하철 노선에 역을 맵핑하는 기능은 아직 없지만 노선 조회시 포함된 역 목록이 함께 응답됩니다.
```

### 힌트
인수 테스트 격리
- DirtiesContext
  - Spring Context를 이용한 테스트 동작 시 스프링 빈의 상태가 변경되면 해당 컨텍스트의 재사용이 불가하여 컨택스트를 다시 로드해야함
  - 스프링빈의 상태가 변경되었다는 설정을 하는 애너테이션
  - 테스트 DB는 메모리 디비로 컨테이너에 띄워져있는 상태이므로 컨텍스트가 다시 로드되면 기존 DB의 내용이 초기화됨
  
- @Sql
  - 테스트 수행 시 특정 쿼리를 동작시키는 애너테이션
  - Table Truncate
  - 테이블을 조회하여 각 테이블을 Truncate시켜주는 방법

인수 테스트 리팩터링
- 중복 코드 처리
  - 지하철역과 노선 인수 테스트를 작성하면서 중복되는 부분이 발생하는데 이 부분을 리팩터링 하면 부가적인 코드는 테스트로부터 분리되어 테스트에 조금 더 집중할 수 있게됨

---
### 구현 기능 목록
- [x] 지하철 노선 기능 구현을 위한 Entity 정의
  - 식별자 번호 : Long, PK 채번을 위한 IDENTITY 전략 적용
  - 지하철 노선명 : String, 중복 노선 생성 방지를 위한 Unique 제약조건 설정
  - 지하철 노선 색상 코드 : String
  - 상행종점역 : Station 엔티티와 1:1 연관관계 설정
  - 하행종점역 : Station 엔티티와 1:1 연관관계 설정
  - 운행거리 : int or double 
  
- [x] 지하철 노선 생성 API
  - [x] Service 
    - [x] 요청의 상행/하행 종점역 번호 조회 및 조회 결과를 이용한 지하철 노선 생성
    - [x] 요청/응답 객체 정의
  - [x] Controller
      - 요청 : POST /lines
        ```
        {
            "name": "신분당선", // 지하철 노선 명
            "color": "bg-red-600", // 지하철 노선 색상 코드
            "upStationId": "1", // 상행종점역 번호
            "downStationId": "2", // 하행종점역 번호
            "distance": "10" // 운행 거리
        }
        ```
      - 응답 : 201 Created 
        ```
        {
            "id": 1, // 지하철 노선 식별자 번호
            "name": "신분당선", // 지하철 노선명
            "color": "bg-red-600", // 지하철 노선 색상 코드
            "stations": [ // 지하철 상행/하행 종점역 정보
                {
                    "id": 1,
                    "name": "신사역"
                },
                {
                    "id": 2,
                    "name": "양재역"
                }
            ]
        }
        ```

- [x] 지하철 노선 목록 조회 API
  - [x] Controller
      - 요청 : GET /lines
      - 응답 : 200 OK 
        ```
        [
            {
                "id": 1,
                "name": "1호선",
                "color": "bg-blue-600",
                "stations": [
                    {
                        "id": 1,
                        "name": "구로역",
                    },
                    {
                        "id": 2,
                        "name": "가산 디지털단지역",
                    }
                ]
            }
        ]
        ```
- [x] 특정 지하철 노선 조회 API
  - [x] Controller
    - 요청 : GET /lines/{id}
    - 응답 : 200 OK
    ```
    {
        "id": 1,
        "name": "신분당선",
        "color": "some-color-code",
        "stations": [
            {
                "id": 1,
                "name": "강남역"
            },
            {
                "id": 2,
                "name": "판교역"
            }
        ]
    }
    ```
- [x] 특정 지하철 노선 수정 API
  - [x] Service
    - 요청 객체 정의
  - [x] Controller
    - 요청 : PUT /lines/{id}
    ```
    {
        "name": "분당선",
        "color": "bg-yellow-600"
    }
    ```
    - 응답 : 200 OK
- [x] 특정 지하철 노선 삭제 API
  - [x] Controller
    - 요청 : DELETE /lines/{id}
    - 응답 : 204 No Content

---

### 코드 리뷰 피드백 TODO List
[x] 인수테스트 작성 시 중복으로 작성되는 설정 부 추출
    - AcceptanceTest : 인수테스트 작성에 공통적으로 명시되는 Annotations 설정을 Custom Annotation 으로 추출
    - BaseTest : 인수 테스트 실행에 필요한 처리 부 추출(RestAssured port 설정, DB 데이터 초기화를 위한 Tear Down)
[x] 명확하지 않은 테스트 내용 표현 개선
[ ] `Given`절에 대한 검증 부 제거
[ ] 개행을 이용한 인수 조건 표현 개선
